<link rel="stylesheet" href="{{ "/assets/css/sidebar.css" | relative_url }}" media="screen and (min-width: 70em)">

<!-- Mobile Topbar -->
<div class="mobile-topbar">
  <div class="site-title">{{ site.title }}</div>
  <nav class="mobile-nav">
    <a href="{{ "/" | relative_url }}" aria-label="Home">
      <svg aria-hidden="true" class="icon" style="width: 16px; height: 16px;"><use xlink:href="{{ "/assets/fontawesome/icons.svg" | relative_url }}#home"></use></svg>
    </a>
    <a href="{{ "/blog" | relative_url }}" aria-label="Blog">Blog</a>
    <a href="{{ "/project" | relative_url }}" aria-label="Projects">Projects</a>
    <a href="{{ "/cv" | relative_url }}" aria-label="Resume">Resume</a>
  </nav>
</div>

<!-- Desktop Sidebar - 只在桌面端显示 -->
<aside class="desktop-sidebar" style="display: none">
  <div class="sidebar-content">
    <nav class="main-nav">
    {%- for item in site.navigation -%}
      {%- assign node = site.pages | where: "name", item.file | first -%}
      {%- assign url = item.url | default: node.url -%}
      {%- assign title = item.title | default: node.title -%}
      {%- assign icon = item.icon | default: item.sidebaricon -%}
      <a aria-label="{{ title }}" href="{{ url | relative_url }}" {% if url == page.url %}class="selected"{% endif %} data-nav-item>
        <svg aria-hidden="true" class="icon"><use xlink:href="{{ "/assets/fontawesome/icons.svg" | relative_url }}#{{ icon }}"></use></svg>
        <span aria-hidden="true">{{ title }}</span>
        <div class="ripple-effect"></div>
      </a>
    {%- endfor -%}
    </nav>
    
    <div class="sidebar-bottom">
      <nav class="bottom-nav">
      {%- for item in site.external -%}
        {%- assign node = site.pages | where: "name", item.file | first -%}
        {%- assign url = item.url | default: node.url -%}
        {%- assign title = item.title | default: node.title -%}
        {%- assign icon = item.icon | default: item.sidebaricon -%}
        <a aria-label="{{ title }}" href="{{ url | relative_url }}" {% if url == page.url %}class="selected"{% endif %} data-nav-item>
          <svg aria-hidden="true" class="icon"><use xlink:href="{{ "/assets/fontawesome/icons.svg" | relative_url }}#{{ icon }}"></use></svg>
          <span aria-hidden="true">{{ title }}</span>
          <div class="ripple-effect"></div>
        </a>
      {%- endfor -%}
      </nav>
      <div class="description">{{ site.description }}</div>
    </div>
  </div>
</aside>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 检测屏幕尺寸并显示/隐藏相应的导航
  function updateNavigation() {
    const isMobile = window.innerWidth <= 70 * 16; // 70em = 1120px
    const mobileTopbar = document.querySelector('.mobile-topbar');
    const desktopSidebar = document.querySelector('.desktop-sidebar');
    
    if (isMobile) {
      // 移动端：隐藏桌面端sidebar，显示移动端topbar
      if (desktopSidebar) {
        desktopSidebar.style.display = 'none';
        desktopSidebar.style.visibility = 'hidden';
        desktopSidebar.style.opacity = '0';
        desktopSidebar.style.pointerEvents = 'none';
      }
      if (mobileTopbar) {
        mobileTopbar.style.display = 'flex';
        mobileTopbar.style.visibility = 'visible';
        mobileTopbar.style.opacity = '1';
        mobileTopbar.style.pointerEvents = 'auto';
      }
    } else {
      // 桌面端：显示桌面端sidebar，隐藏移动端topbar
      if (desktopSidebar) {
        desktopSidebar.style.display = 'block';
        desktopSidebar.style.visibility = 'visible';
        desktopSidebar.style.opacity = '1';
        desktopSidebar.style.pointerEvents = 'auto';
      }
      if (mobileTopbar) {
        mobileTopbar.style.display = 'none';
        mobileTopbar.style.visibility = 'hidden';
        mobileTopbar.style.opacity = '0';
        mobileTopbar.style.pointerEvents = 'none';
      }
    }
  }

  // 初始调用
  updateNavigation();
  
  // 监听窗口大小变化
  window.addEventListener('resize', updateNavigation);

  // 为所有导航链接添加点击波纹效果
  const navItems = document.querySelectorAll('[data-nav-item]');
  
  navItems.forEach(item => {
    item.addEventListener('click', function(e) {
      // 创建波纹效果
      const ripple = this.querySelector('.ripple-effect');
      if (ripple) {
        ripple.style.animation = 'none';
        ripple.offsetHeight; // 触发重排
        ripple.style.animation = 'gentleRipple 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      }
      
      // 添加更柔和的点击反馈
      this.style.transform = 'scale(0.98)'; // 减少缩放幅度
      setTimeout(() => {
        this.style.transform = '';
      }, 200); // 增加持续时间
    });
    
    // 添加键盘导航支持
    item.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.click();
      }
    });
  });
  
  // 为选中的导航项添加活跃状态动画
  const selectedItem = document.querySelector('.selected');
  if (selectedItem) {
    selectedItem.style.animation = 'gentleSelectedPulse 3s ease-in-out infinite';
  }
});
</script>
